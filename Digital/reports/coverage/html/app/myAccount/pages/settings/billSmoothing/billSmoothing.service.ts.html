<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for app\myAccount\pages\settings\billSmoothing\billSmoothing.service.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../../../index.html">all files</a> / <a href="index.html">app/myAccount/pages/settings/billSmoothing/</a> billSmoothing.service.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">12.54% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>37/295</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">4.68% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>8/171</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">1.54% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>1/65</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">13.26% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>35/264</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { Injectable } from '@angular/core';
import * as jwt_decode from 'jwt-decode';
import * as moment from 'moment';
import { Observable } from 'rxjs/Observable';
import { ApiService } from '../../../../shared/service/api.service';
import { AccountViewModel, ContractViewModel, IAccountServiceMA } from '../../..//services/account.service';
&nbsp;
import * as _ from 'lodash';
import { AccountDetailComponentModel } from '../../../../myAccount/settings/accountDetail/accountDetail.component';
import { AlertType } from '../../../../shared/globals/alertType';
import { State } from '../../../../shared/globals/oneMinuteMove/state';
import { ConfigService } from '../../../../shared/service/config.service';
import { SettingsAggregateModel } from '../../../services/settings/model/settingsAggregateModel';
import { ISettingsService } from '../../../services/settings/settings.service.interface';
import {
    AlertDisplayModel,
    BillSmoothingAccountModel,
    BillSmoothingAccountsViewModel,
    BillSmoothingEstimatesViewModel,
    BillSmoothingFrequency,
    BillSmoothingFuelDisplayModel,
    BillSmoothingInternalErrorTypes,
    LivePersonEngagementTypes
} from './billSmoothing.model';
&nbsp;
declare let leanengage: any;
&nbsp;
@Injectable()
export class BillSmoothingService {
    /**
     * Generates a formatted date like:
     * (Thursday 10 Nov 2016)
     * @param {any} date
     * @returns string
     * @memberof BillSmoothingAccountsService
     */
    public static generateLongDate(date<span class="fstat-no" title="function not covered" >) {</span>
<span class="cstat-no" title="statement not covered" >        return moment(date).format('dddd DD MMM YYYY');</span>
    }
&nbsp;
    /**
     * Generates a formatted date like:
     * (10 Nov 2016)
     * @param {any} date
     * @returns string
     * @memberof BillSmoothingAccountsService
     */
    public static generateShortDate(date<span class="fstat-no" title="function not covered" >) {</span>
<span class="cstat-no" title="statement not covered" >        return moment(date).format('DD MMM Y');</span>
    }
&nbsp;
    /**
     * Generates a day from a supplied date like:
     * (Thursday)
     *
     * @param {any} date
     * @returns string
     * @memberof BillSmoothingAccountsService
     */
    public static generateDayFromDate(date<span class="fstat-no" title="function not covered" >) {</span>
<span class="cstat-no" title="statement not covered" >        return moment(date).format('dddd');</span>
    }
&nbsp;
    /**
     * Generates a formatted date like:
     * (10th)
     * @param {any} date
     * @returns string
     * @memberof BillSmoothingAccountsService
     */
    public static generateOrdinalDate(date<span class="fstat-no" title="function not covered" >) {</span>
<span class="cstat-no" title="statement not covered" >        return moment(date).format('Do');</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    public static showLeanEngageSurveyOnSuccessfulSetup() {</span>
        let nameId: string;
        let leanAppId = <span class="cstat-no" title="statement not covered" >new ConfigService().current.leanEngageAppId;</span>
        let bearerToken = <span class="cstat-no" title="statement not covered" >sessionStorage.getItem('Bearer');</span>
<span class="cstat-no" title="statement not covered" >        if (bearerToken) {</span>
<span class="cstat-no" title="statement not covered" >            nameId = jwt_decode(bearerToken)['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier'];</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        leanengage('start', { user_id: nameId, name: nameId, app_id: leanAppId });</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        leanengage('triggerSurvey', 'bill-smoothing-set-up-success-clone');</span>
    }
&nbsp;
    public turnOnChangesToReduceWorkloadOfCallCentre: boolean;
&nbsp;
    private accounts: AccountViewModel[];
    private settings: SettingsAggregateModel;
&nbsp;
    constructor(
        public <span class="cstat-no" title="statement not covered" >accountService: IAccountServiceMA,</span>
        public <span class="cstat-no" title="statement not covered" >iSettingsService: ISettingsService<span class="branch-2 cbranch-no" title="branch not covered" >,</span></span>
        public <span class="cstat-no" title="statement not covered" >apiService: ApiService<span class="fstat-no" title="function not covered" ><span class="branch-2 cbranch-no" title="branch not covered" ></span></span></span>
    ) {
<span class="cstat-no" title="statement not covered" >        this.turnOnChangesToReduceWorkloadOfCallCentre = false;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >    public generateBillSmoothingViewModel(): Observable&lt;BillSmoothingAccountModel[]&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >        return Observable.forkJoin(</span>
            this.accountService.getAccounts(),
            this.iSettingsService.getSettings()
        )
        .flatMap(
            (results<span class="fstat-no" title="function not covered" >) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >                this.accounts = results[0];</span>
                let activeAccounts = <span class="cstat-no" title="statement not covered" >this.accounts.filter((account<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >!account.allContractsAreRestricted)</span></span>.map((activeAccount<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >Object.assign({}, activeAccount))</span></span>;</span>
<span class="cstat-no" title="statement not covered" >                activeAccounts.forEach((account<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                    account.contracts = account.contracts.filter((contract<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >!contract.isRestricted)</span></span>;</span>
                });
<span class="cstat-no" title="statement not covered" >                this.settings = results[1];</span>
&nbsp;
                const estimates: Array&lt;Observable&lt;BillSmoothingAccountsViewModel&gt;&gt; = <span class="cstat-no" title="statement not covered" >activeAccounts.map((account: AccountViewModel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                    if (account.contracts.every((c<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >c.isBillSmoothingV2)</span></span>) {</span>
<span class="cstat-no" title="statement not covered" >                        return Observable.of&lt;BillSmoothingAccountsViewModel&gt;({</span>
                            contractAccountNumber: Number(account.accountNumber),
                            estimates: null,
                            error: null
                        });
                    } else {
<span class="cstat-no" title="statement not covered" >                        return this.apiService.getBillSmoothingEstimates(account.accountNumber);</span>
                    }
                });
<span class="cstat-no" title="statement not covered" >                return Observable.forkJoin(estimates)</span>
                .map(
                    (accountViewModels: BillSmoothingAccountsViewModel[]<span class="fstat-no" title="function not covered" >) =&gt; {</span>
                        let accountModels: BillSmoothingAccountModel[] = <span class="cstat-no" title="statement not covered" >activeAccounts.map((account<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
                            const accountViewModel = <span class="cstat-no" title="statement not covered" >accountViewModels.find((acc<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >acc.contractAccountNumber === Number(account.accountNumber))</span></span>;</span>
&nbsp;
                            const accountModel = <span class="cstat-no" title="statement not covered" >new BillSmoothingAccountModel();</span>
&nbsp;
                            // update various properties for account model
<span class="cstat-no" title="statement not covered" >                            accountModel.accountDetailModel = new AccountDetailComponentModel(account);</span>
<span class="cstat-no" title="statement not covered" >                            accountModel.accountDetailModel.isDirectDebit = account.contracts[0].isDirectDebit;</span>
<span class="cstat-no" title="statement not covered" >                            accountModel.allContractsHaveDirectDebit = account.contracts.every((contract: ContractViewModel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >contract.isDirectDebit)</span></span>;</span>
<span class="cstat-no" title="statement not covered" >                            accountModel.hasEstimatesApiError = accountViewModel.hasEstimatesApiError;</span>
<span class="cstat-no" title="statement not covered" >                            accountModel.hasDuplicateFuels = this.hasDuplicateFuels(account);</span>
&nbsp;
                            // create fuel models
<span class="cstat-no" title="statement not covered" >                            accountModel.billSmoothingFuelModel = account.contracts.map((contract<span class="fstat-no" title="function not covered" >) =&gt;</span></span>
<span class="cstat-no" title="statement not covered" >                                this.createBillSmoothingFuelDisplayModel(contract, accountViewModel, accountModel.hasDuplicateFuels)</span>
                            );
&nbsp;
                            // update consolidated item properties for account model
                            const hasMultipleChatButtons = <span class="cstat-no" title="statement not covered" >accountModel.billSmoothingFuelModel.filter((fuel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >fuel.hasChatButton)</span></span>.length &gt; 1;</span>
<span class="cstat-no" title="statement not covered" >                            accountModel.hasConsolidatedChatButton = accountModel.hasDuplicateFuels || accountModel.hasEstimatesApiError || hasMultipleChatButtons;</span>
&nbsp;
                            const numberOfMessages = <span class="cstat-no" title="statement not covered" >accountModel.billSmoothingFuelModel.filter((fuel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >fuel.hasMessage)</span></span>.length;</span>
                            const hasMultipleMessages = <span class="cstat-no" title="statement not covered" >numberOfMessages &gt; 1;</span>
                            const hasSingleMessage = <span class="cstat-no" title="statement not covered" >numberOfMessages === 1;</span>
<span class="cstat-no" title="statement not covered" >                            accountModel.hasConsolidatedMessages = (!accountModel.hasDuplicateFuels  &amp;&amp; !accountModel.hasEstimatesApiError &amp;&amp; hasMultipleChatButtons &amp;&amp; hasSingleMessage) || hasMultipleMessages;</span>
&nbsp;
                            const hasMultipleSetupButtons = <span class="cstat-no" title="statement not covered" >accountModel.billSmoothingFuelModel.filter((fuel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >fuel.hasSetupButton)</span></span>.length &gt; 1;</span>
<span class="cstat-no" title="statement not covered" >                            accountModel.hasConsolidatedSetUpButton = hasMultipleSetupButtons;</span>
&nbsp;
                            // update consolidated item properties for fuel models
<span class="cstat-no" title="statement not covered" >                            accountModel.billSmoothingFuelModel.forEach((fuelModel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                                fuelModel.hasChatButton = fuelModel.hasChatButton &amp;&amp; !accountModel.hasConsolidatedChatButton;</span>
<span class="cstat-no" title="statement not covered" >                                fuelModel.hasSetupButton = fuelModel.hasSetupButton &amp;&amp; !accountModel.hasConsolidatedSetUpButton;</span>
<span class="cstat-no" title="statement not covered" >                                fuelModel.hasMessage = fuelModel.hasMessage &amp;&amp; !accountModel.hasConsolidatedMessages;</span>
                            });
&nbsp;
<span class="cstat-no" title="statement not covered" >                            this.updateButtonLine(accountModel);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                            return accountModel;</span>
                        });
&nbsp;
<span class="cstat-no" title="statement not covered" >                        this.updateLivePersonEngagementType(accountModels);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                        return accountModels;</span>
                    }
                );
            }
        );
    }
&nbsp;
    // Update account models to hide chat buttons and alter alert messages. This is a temporary solution to reduce workload of call centre.
    // Writing it into a separate function makes it easier to throw away in the future.
    // It can be removed or modified when call centre has changed its capability
<span class="cstat-no" title="statement not covered" >    public updateChatButtonsToReduceWorkloadOfCallCentre(accountModels: BillSmoothingAccountModel[]<span class="fstat-no" title="function not covered" >) {</span></span>
<span class="cstat-no" title="statement not covered" >        if (!this.turnOnChangesToReduceWorkloadOfCallCentre) {</span>
<span class="cstat-no" title="statement not covered" >            return;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        accountModels.forEach((accountModel: BillSmoothingAccountModel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
            // update message
<span class="cstat-no" title="statement not covered" >            accountModel.billSmoothingFuelModel.forEach((fuelModel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                if (!fuelModel.hasBillSmoothing) {</span>
<span class="cstat-no" title="statement not covered" >                    if (accountModel.hasDuplicateFuels) {</span>
                        const alert = <span class="cstat-no" title="statement not covered" >new AlertDisplayModel(BillSmoothingInternalErrorTypes.DuplicatedFuels, AlertType.error, 'This service is not eligible for Bill Smoothing.', 'Get in touch with us &lt;a href="https://www.agl.com.au/residential/contact-us" class="link" target="_blank"&gt;here&lt;/a&gt; to find out how you can make the switch to Bill Smoothing.');</span>
<span class="cstat-no" title="statement not covered" >                        this.updateAlertByBillSmoothingInternalErrorType(BillSmoothingInternalErrorTypes.DuplicatedFuels, fuelModel.alerts, alert);</span>
                    } else <span class="cstat-no" title="statement not covered" >if (fuelModel.hasEstimatesApiError) {</span>
                        const alert = <span class="cstat-no" title="statement not covered" >new AlertDisplayModel(BillSmoothingInternalErrorTypes.EstimateError, AlertType.error, 'Bill Smoothing is currently unavailable.', `Sorry, we're just ironing out the kinks. Please try again later, or get in touch with us &lt;a href="https://www.agl.com.au/residential/contact-us" class="link" target="_blank"&gt;here&lt;/a&gt;.`);</span>
<span class="cstat-no" title="statement not covered" >                        this.updateAlertByBillSmoothingInternalErrorType(BillSmoothingInternalErrorTypes.EstimateError, fuelModel.alerts, alert);</span>
                    } else <span class="cstat-no" title="statement not covered" >if (!fuelModel.isEligibleForBillSmoothing) {</span>
<span class="cstat-no" title="statement not covered" >                        this.updateAlertForIneligibility(fuelModel.alerts, fuelModel.fuel, fuelModel.paymentOverdue);</span>
                    }
                }
            });
&nbsp;
            // remove consolidated chat button
<span class="cstat-no" title="statement not covered" >            if (accountModel.hasConsolidatedMessages || accountModel.hasConsolidatedChatButton) {</span>
                const numberOfOverdues = <span class="cstat-no" title="statement not covered" >!accountModel.hasDuplicateFuels &amp;&amp; accountModel.billSmoothingFuelModel.filter((fuelModel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                    if (!fuelModel.hasBillSmoothing &amp;&amp; !fuelModel.hasEstimatesApiError &amp;&amp; !fuelModel.isEligibleForBillSmoothing) {</span>
<span class="cstat-no" title="statement not covered" >                        if (fuelModel.alerts.some((a<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >a.IsOverdueAlert)</span></span>) {</span>
<span class="cstat-no" title="statement not covered" >                            return true;</span>
                        }
                    }
<span class="cstat-no" title="statement not covered" >                    return false;</span>
                }).length;
                const numberOfBillSmoothings = <span class="cstat-no" title="statement not covered" >accountModel.billSmoothingFuelModel.filter((fuelModel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >fuelModel.hasBillSmoothing)</span></span>.length;</span>
                const multipleBillSmoothing = <span class="cstat-no" title="statement not covered" >numberOfBillSmoothings &gt; 1;</span>
                const oneOverdueAndOneBillSmoothing = <span class="cstat-no" title="statement not covered" >(numberOfOverdues === 1) &amp;&amp; (numberOfBillSmoothings === 1);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                if (!multipleBillSmoothing &amp;&amp; !oneOverdueAndOneBillSmoothing) {</span>
<span class="cstat-no" title="statement not covered" >                    accountModel.hasConsolidatedMessages = false;</span>
                }
&nbsp;
                const multipleOverdue = <span class="cstat-no" title="statement not covered" >numberOfOverdues &gt; 1;</span>
                const multipleOverdueAndNotDuplicated = <span class="cstat-no" title="statement not covered" >multipleOverdue &amp;&amp; !accountModel.hasDuplicateFuels;</span>
<span class="cstat-no" title="statement not covered" >                if ((!multipleBillSmoothing &amp;&amp; !multipleOverdueAndNotDuplicated &amp;&amp; !oneOverdueAndOneBillSmoothing) || accountModel.hasEstimatesApiError) {</span>
<span class="cstat-no" title="statement not covered" >                    accountModel.hasConsolidatedChatButton = false;</span>
                }
            }
&nbsp;
            // add back individual buttons for the removed consolidated button
<span class="cstat-no" title="statement not covered" >            accountModel.billSmoothingFuelModel.forEach((fuelModel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                if (!fuelModel.hasEstimatesApiError) {</span>
<span class="cstat-no" title="statement not covered" >                    if (fuelModel.hasBillSmoothing) {</span>
<span class="cstat-no" title="statement not covered" >                        fuelModel.hasChatButton = !accountModel.hasConsolidatedChatButton;</span>
<span class="cstat-no" title="statement not covered" >                        fuelModel.hasMessage = !accountModel.hasConsolidatedMessages &amp;&amp; !fuelModel.hasDirectDebit;</span>
                    } else <span class="cstat-no" title="statement not covered" >if (!accountModel.hasDuplicateFuels &amp;&amp; !fuelModel.isEligibleForBillSmoothing) {</span>
<span class="cstat-no" title="statement not covered" >                        if (fuelModel.alerts.some((a<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >a.IsOverdueAlert)</span></span>) {</span>
<span class="cstat-no" title="statement not covered" >                            fuelModel.hasChatButton = !accountModel.hasConsolidatedChatButton;</span>
                        } else {
<span class="cstat-no" title="statement not covered" >                            fuelModel.hasChatButton = false;</span>
                        }
                    }
                }
            });
&nbsp;
<span class="cstat-no" title="statement not covered" >            this.updateButtonLine(accountModel);</span>
        });
    }
&nbsp;
    public getStartInformationSubtext(frequency: BillSmoothingFrequency, isDirectDebit: boolean, selectedDay: string, selectedDateOrdinal: string<span class="fstat-no" title="function not covered" >): string {</span>
        const frequencyWithDirectDebitToPaymentMessageMap = {
            [BillSmoothingFrequency.Weekly]: `We will debit your nominated account every ${selectedDay}.`,
            [BillSmoothingFrequency.Fortnightly]: `We will debit your nominated account every second ${selectedDay}.`,
            [BillSmoothingFrequency.Monthly]: `We will debit your nominated account on the ${selectedDateOrdinal} of every month from your start date.`
        };
&nbsp;
        const frequencyWithoutDirectDebitToPaymentMessageMap = {
            [BillSmoothingFrequency.Weekly]: `Payments will be due every ${selectedDay} from your start date.`,
            [BillSmoothingFrequency.Fortnightly]: `Payments will be due every second ${selectedDay} from your start date.`,
            [BillSmoothingFrequency.Monthly]: `Payments will be due on the ${selectedDateOrdinal} of every month from your start date.`
        };
&nbsp;
        const frequencyToPaymentMessageMap = <span class="cstat-no" title="statement not covered" >isDirectDebit ? frequencyWithDirectDebitToPaymentMessageMap : frequencyWithoutDirectDebitToPaymentMessageMap;</span>
&nbsp;
        let result = <span class="cstat-no" title="statement not covered" >frequencyToPaymentMessageMap[frequency] || '';</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        return result;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    public generateBillCycleChangeMessage(billSmoothingFuels: BillSmoothingFuelDisplayModel[]<span class="fstat-no" title="function not covered" >): string {</span></span>
<span class="cstat-no" title="statement not covered" >        if (billSmoothingFuels.some((billSmoothingFuel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >this.isGasBasicMeterInVic(billSmoothingFuel))</span></span>) {</span>
<span class="cstat-no" title="statement not covered" >            if (billSmoothingFuels.some((billSmoothingFuel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >this.isElectricityBasicMeterInVic(billSmoothingFuel))</span></span>) {</span>
<span class="cstat-no" title="statement not covered" >                return `If you are on monthly billing with a basic meter, once you switch to Bill Smoothing, your bill cycle will change and we'll bill you every quarter for Electricity, and every two months for Gas.`;</span>
            } else {
<span class="cstat-no" title="statement not covered" >                return `If you are on monthly billing with a basic meter, once you switch to Bill Smoothing, your bill cycle will change and we'll bill you every two months.`;</span>
            }
        } else <span class="cstat-no" title="statement not covered" >if (billSmoothingFuels.some((billSmoothingFuel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >!billSmoothingFuel.isSmartMeter)</span></span>) {</span>
<span class="cstat-no" title="statement not covered" >            return `If you are on monthly billing with a basic meter, once you switch to Bill Smoothing, your bill cycle will change and we'll bill you every quarter.`;</span>
        }
<span class="cstat-no" title="statement not covered" >        return '';</span>
    }
&nbsp;
    public removeButtonLinesForLivePersonIntegration(accountModels: BillSmoothingAccountModel[]<span class="fstat-no" title="function not covered" >) {</span>
        let alreadyHasModifyLivePersonButton = <span class="cstat-no" title="statement not covered" >false;</span>
        let alreadyHasOverdueLivePersonButton = <span class="cstat-no" title="statement not covered" >false;</span>
        let alreadyHasModifyAndOverdueLivePersonButton = <span class="cstat-no" title="statement not covered" >false;</span>
<span class="cstat-no" title="statement not covered" >        accountModels.forEach((accountModel: BillSmoothingAccountModel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >            if ((alreadyHasModifyLivePersonButton &amp;&amp; (accountModel.livePersonEngagementType === LivePersonEngagementTypes.LPBillSmoothingModify)) ||</span>
                (alreadyHasOverdueLivePersonButton &amp;&amp; (accountModel.livePersonEngagementType === LivePersonEngagementTypes.LPBillSmoothingOverdue)) ||
                (alreadyHasModifyAndOverdueLivePersonButton &amp;&amp; (accountModel.livePersonEngagementType === LivePersonEngagementTypes.LPBillSmoothingOverdueAndModify))) {
<span class="cstat-no" title="statement not covered" >                    accountModel.hasButtonLineAboveMessage = false;</span>
<span class="cstat-no" title="statement not covered" >                    accountModel.hasButtonLineBelowMessage = false;</span>
            }
<span class="cstat-no" title="statement not covered" >            if (accountModel.livePersonEngagementType) {</span>
<span class="cstat-no" title="statement not covered" >                switch (accountModel.livePersonEngagementType) {</span>
                    case LivePersonEngagementTypes.LPBillSmoothingModify:
<span class="cstat-no" title="statement not covered" >                        alreadyHasModifyLivePersonButton = true;</span>
<span class="cstat-no" title="statement not covered" >                        break;</span>
                    case LivePersonEngagementTypes.LPBillSmoothingOverdue:
<span class="cstat-no" title="statement not covered" >                        alreadyHasOverdueLivePersonButton = true;</span>
<span class="cstat-no" title="statement not covered" >                        break;</span>
                    case LivePersonEngagementTypes.LPBillSmoothingOverdueAndModify:
<span class="cstat-no" title="statement not covered" >                        alreadyHasModifyAndOverdueLivePersonButton = true;</span>
<span class="cstat-no" title="statement not covered" >                        break;</span>
                }
            }
<span class="cstat-no" title="statement not covered" >            accountModel.billSmoothingFuelModel.forEach((fuel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                if (fuel.livePersonEngagementType) {</span>
<span class="cstat-no" title="statement not covered" >                    switch (fuel.livePersonEngagementType) {</span>
                        case LivePersonEngagementTypes.LPBillSmoothingModify:
<span class="cstat-no" title="statement not covered" >                            alreadyHasModifyLivePersonButton = true;</span>
<span class="cstat-no" title="statement not covered" >                            break;</span>
                        case LivePersonEngagementTypes.LPBillSmoothingOverdue:
<span class="cstat-no" title="statement not covered" >                            alreadyHasOverdueLivePersonButton = true;</span>
<span class="cstat-no" title="statement not covered" >                            break;</span>
                        case LivePersonEngagementTypes.LPBillSmoothingOverdueAndModify:
<span class="cstat-no" title="statement not covered" >                            alreadyHasModifyAndOverdueLivePersonButton = true;</span>
<span class="cstat-no" title="statement not covered" >                            break;</span>
                    }
                }
            });
        });
    }
&nbsp;
    private updateButtonLine(accountModel: BillSmoothingAccountModel<span class="fstat-no" title="function not covered" >) {</span>
        const numberOfOnBillSmoothing = <span class="cstat-no" title="statement not covered" >accountModel.billSmoothingFuelModel.filter((fuel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >fuel.hasBillSmoothing)</span></span>.length;</span>
<span class="cstat-no" title="statement not covered" >        accountModel.hasButtonLineAboveMessage = accountModel.hasConsolidatedButton &amp;&amp; (numberOfOnBillSmoothing &gt; 1);</span>
<span class="cstat-no" title="statement not covered" >        accountModel.hasButtonLineBelowMessage = accountModel.hasConsolidatedButton &amp;&amp; (numberOfOnBillSmoothing &lt;= 1);</span>
    }
&nbsp;
    private updateLivePersonEngagementType(accountModels: BillSmoothingAccountModel[]<span class="fstat-no" title="function not covered" >) {</span>
<span class="cstat-no" title="statement not covered" >        accountModels.forEach((accountModel: BillSmoothingAccountModel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >            if (accountModel.billSmoothingFuelModel.some((fuel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >fuel.hasBillSmoothing)</span></span> &amp;&amp;</span>
                accountModel.billSmoothingFuelModel.some((fuel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >fuel.alerts.some((a<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >a.IsOverdueAlert)</span></span>)</span></span>) {
<span class="cstat-no" title="statement not covered" >                accountModel.livePersonEngagementType = LivePersonEngagementTypes.LPBillSmoothingOverdueAndModify;</span>
            } else <span class="cstat-no" title="statement not covered" >if (accountModel.billSmoothingFuelModel.filter((fuel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >fuel.hasBillSmoothing)</span></span>.length &gt; 1) {</span>
<span class="cstat-no" title="statement not covered" >                accountModel.livePersonEngagementType = LivePersonEngagementTypes.LPBillSmoothingModify;</span>
            } else <span class="cstat-no" title="statement not covered" >if (accountModel.billSmoothingFuelModel.filter((fuel<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >fuel.alerts.some((a<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >a.IsOverdueAlert)</span></span>)</span></span>.length &gt; 1) {</span>
<span class="cstat-no" title="statement not covered" >                accountModel.livePersonEngagementType = LivePersonEngagementTypes.LPBillSmoothingOverdue;</span>
            } else {
<span class="cstat-no" title="statement not covered" >                accountModel.billSmoothingFuelModel.forEach((fuel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                    if (fuel.hasBillSmoothing) {</span>
<span class="cstat-no" title="statement not covered" >                        fuel.livePersonEngagementType = LivePersonEngagementTypes.LPBillSmoothingModify;</span>
                    } else <span class="cstat-no" title="statement not covered" >if (fuel.alerts.some((a<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >a.IsOverdueAlert)</span></span>) {</span>
<span class="cstat-no" title="statement not covered" >                        fuel.livePersonEngagementType = LivePersonEngagementTypes.LPBillSmoothingOverdue;</span>
                    }
                });
            }
        });
    }
&nbsp;
    private isGasBasicMeterInVic(billSmoothingFuel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >): boolean {</span>
<span class="cstat-no" title="statement not covered" >        return billSmoothingFuel.regionId === State.VIC.toString() &amp;&amp; !billSmoothingFuel.isSmartMeter &amp;&amp; billSmoothingFuel.isGas;</span>
    }
&nbsp;
    private isElectricityBasicMeterInVic(billSmoothingFuel: BillSmoothingFuelDisplayModel<span class="fstat-no" title="function not covered" >): boolean {</span>
<span class="cstat-no" title="statement not covered" >        return billSmoothingFuel.regionId === State.VIC.toString() &amp;&amp; !billSmoothingFuel.isSmartMeter &amp;&amp; billSmoothingFuel.isElectricity;</span>
    }
&nbsp;
    private createBillSmoothingFuelDisplayModel(contract: ContractViewModel, accountViewModel: BillSmoothingAccountsViewModel, accountHasDuplicateFuels: boolean<span class="fstat-no" title="function not covered" >): BillSmoothingFuelDisplayModel {</span>
        const bsFuelModel = <span class="cstat-no" title="statement not covered" >new BillSmoothingFuelDisplayModel();</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.paymentContractInfo = contract;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.contractAccountNumber = Number(contract.accountNumber);</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.contractNumber = Number(contract.contractNumber);</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.fuel = contract.fuelType;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.hasBillSmoothing = contract.isBillSmoothingV2;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.hasDirectDebit = contract.isDirectDebit;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.paymentOverdue = contract.paymentOverdue;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.hasChatButton = false;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.hasSetupButton = false;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.hasMessage = false;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.isSmartMeter = contract.isSmartMeter;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.regionId = contract.regionId;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.isElectricity = contract.isElectricity;</span>
<span class="cstat-no" title="statement not covered" >        bsFuelModel.isGas = contract.isGas;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (bsFuelModel.hasBillSmoothing) {</span>
<span class="cstat-no" title="statement not covered" >            bsFuelModel.paymentScheme = contract.paymentScheme;</span>
            // chat button if contract is on bill smoothing
<span class="cstat-no" title="statement not covered" >            bsFuelModel.hasChatButton = true;</span>
<span class="cstat-no" title="statement not covered" >            if (!accountHasDuplicateFuels &amp;&amp; !accountViewModel.hasEstimatesApiError) {</span>
<span class="cstat-no" title="statement not covered" >                bsFuelModel.hasMessage = !bsFuelModel.hasDirectDebit;</span>
            }
        } else {
<span class="cstat-no" title="statement not covered" >            if (accountHasDuplicateFuels) {</span>
                // add this alert if contract is not on bill smoothing and account has duplicated fuel contracts
                const heading = <span class="cstat-no" title="statement not covered" >'This service is not eligible for Bill Smoothing.';</span>
                const body = <span class="cstat-no" title="statement not covered" >'Chat with us now to find out how you can make the switch to Bill Smoothing.';</span>
<span class="cstat-no" title="statement not covered" >                bsFuelModel.alerts.push(new AlertDisplayModel(BillSmoothingInternalErrorTypes.DuplicatedFuels, AlertType.error, heading, body));</span>
            } else <span class="cstat-no" title="statement not covered" >if (accountViewModel.hasEstimatesApiError) {</span>
<span class="cstat-no" title="statement not covered" >                bsFuelModel.hasEstimatesApiError = true;</span>
                // add this alert if contract is not on bill smoothing and estimate api returns error
                const heading = <span class="cstat-no" title="statement not covered" >'Bill Smoothing is currently unavailable.';</span>
                const body = <span class="cstat-no" title="statement not covered" >`Sorry, we're just ironing out the kinks. Please try again later, or chat online now.`;</span>
<span class="cstat-no" title="statement not covered" >                bsFuelModel.alerts.push(new AlertDisplayModel(BillSmoothingInternalErrorTypes.EstimateError, AlertType.error, heading, body));</span>
            } else {
                let estimatesViewModel<span class="cstat-no" title="statement not covered" >: BillSmoothingEstimatesViewModel;</span>
                let errorNumber<span class="cstat-no" title="statement not covered" >: string;</span>
<span class="cstat-no" title="statement not covered" >                if ( accountViewModel.estimates) {</span>
<span class="cstat-no" title="statement not covered" >                    estimatesViewModel = accountViewModel.estimates.find((c<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >c.contractNumber === Number(contract.contractNumber))</span></span>;</span>
<span class="cstat-no" title="statement not covered" >                    bsFuelModel.isEligibleForBillSmoothing = !!estimatesViewModel.paymentOptions;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                    if (bsFuelModel.isEligibleForBillSmoothing) {</span>
<span class="cstat-no" title="statement not covered" >                        bsFuelModel.paymentOptions = estimatesViewModel.paymentOptions;</span>
<span class="cstat-no" title="statement not covered" >                        bsFuelModel.billDeliveryMethod = this.settings.billDeliveryMethodList.find((b<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >b.contractAccountNumber === contract.accountNumber)</span></span>.billDeliveryMethod;</span>
                        // setup button if contract is not on bill smoothing, is eligible for bill smoothing and account doesn't have duplicated fuel contracts
<span class="cstat-no" title="statement not covered" >                        bsFuelModel.hasSetupButton = true;</span>
                    } else {
                        // chat button if contract is not on bill smoothing and is not eligible for bill smoothing
<span class="cstat-no" title="statement not covered" >                        bsFuelModel.hasChatButton = true;</span>
                        // add this alert if contract is not eligible for bill smoothing and account doesn't have duplicated fuel contracts
<span class="cstat-no" title="statement not covered" >                        errorNumber = estimatesViewModel.error.internalError.errorNumber;</span>
                    }
                } else {
<span class="cstat-no" title="statement not covered" >                    bsFuelModel.isEligibleForBillSmoothing = false;</span>
<span class="cstat-no" title="statement not covered" >                    if (accountViewModel.error) {</span>
<span class="cstat-no" title="statement not covered" >                        errorNumber = accountViewModel.error.internalError.errorNumber;</span>
                    }
                }
<span class="cstat-no" title="statement not covered" >                if (errorNumber) {</span>
                    const fuel = <span class="cstat-no" title="statement not covered" >bsFuelModel.fuel;</span>
                    const paymentOverdue = <span class="cstat-no" title="statement not covered" >bsFuelModel.paymentOverdue;</span>
<span class="cstat-no" title="statement not covered" >                    bsFuelModel.alerts.push(this.getAlertForIneligibility(errorNumber, fuel, paymentOverdue));</span>
                }
            }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return bsFuelModel;</span>
    }
&nbsp;
    private getAlertForIneligibility(errorNumber: string, fuel: string, paymentOverdue: number<span class="fstat-no" title="function not covered" >): AlertDisplayModel {</span>
        // we translate SAP error number to BillSmoothingInternalErrorType here, and only refer to BillSmoothingInternalErrorType in subsequent code flow
        const billSmoothingInternalErrorType = <span class="cstat-no" title="statement not covered" >this.getBillSmoothingInternalErrorTypeBySapErrorNumber(errorNumber);</span>
&nbsp;
        let alert;
<span class="cstat-no" title="statement not covered" >        if (billSmoothingInternalErrorType === BillSmoothingInternalErrorTypes.Overdue) {</span>
<span class="cstat-no" title="statement not covered" >            alert = new AlertDisplayModel(BillSmoothingInternalErrorTypes.Overdue, AlertType.error, `Your ${fuel} account is overdue: $${paymentOverdue.toFixed(2)}`, null);</span>
        } else <span class="cstat-no" title="statement not covered" >if (billSmoothingInternalErrorType === BillSmoothingInternalErrorTypes.Payg) {</span>
<span class="cstat-no" title="statement not covered" >            alert = new AlertDisplayModel(BillSmoothingInternalErrorTypes.Payg, AlertType.error, `You're already set up on AGL Prepaid`, `If you'd like to switch to Bill Smoothing, chat to us now.`);</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (this.turnOnChangesToReduceWorkloadOfCallCentre) {</span>
<span class="cstat-no" title="statement not covered" >            if (billSmoothingInternalErrorType === BillSmoothingInternalErrorTypes.BillSmoothingV1) {</span>
                // this internal error type is added temporarily to reduce call center pressure, its alert heading and body are populated in subsequent call to "updateAlertForIneligibility"
<span class="cstat-no" title="statement not covered" >                alert = new AlertDisplayModel(BillSmoothingInternalErrorTypes.BillSmoothingV1, AlertType.inform, null, null);</span>
            } else <span class="cstat-no" title="statement not covered" >if (billSmoothingInternalErrorType === BillSmoothingInternalErrorTypes.GeneralIneligibility) {</span>
                // this internal error type is added temporarily to reduce call center pressure, its alert heading and body are populated in subsequent call to "updateAlertForIneligibility"
<span class="cstat-no" title="statement not covered" >                alert = new AlertDisplayModel(BillSmoothingInternalErrorTypes.GeneralIneligibility, AlertType.error, null, null);</span>
            }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return alert;</span>
    }
&nbsp;
    // API returns errorNumber in string data type, e.g. 4 can be presented as 04.
    // we resolve error type from errorNumber in this function
    private getBillSmoothingInternalErrorTypeBySapErrorNumber(errorNumber: string<span class="fstat-no" title="function not covered" >): BillSmoothingInternalErrorTypes {</span>
        const errorNumberAsNumber = <span class="cstat-no" title="statement not covered" >Number(errorNumber);</span>
<span class="cstat-no" title="statement not covered" >        if (errorNumberAsNumber === 4) {</span>
<span class="cstat-no" title="statement not covered" >            return BillSmoothingInternalErrorTypes.Overdue;</span>
        } else <span class="cstat-no" title="statement not covered" >if (errorNumberAsNumber === 30) {</span>
<span class="cstat-no" title="statement not covered" >            return BillSmoothingInternalErrorTypes.Payg;</span>
        } else <span class="cstat-no" title="statement not covered" >if (errorNumberAsNumber === 11) {</span>
<span class="cstat-no" title="statement not covered" >            return BillSmoothingInternalErrorTypes.BillSmoothingV1;</span>
        } else {// this will cover the known error codes of 10, 12, 16, 24, 3, 23, 21, 34 plus any other unexpected ones
<span class="cstat-no" title="statement not covered" >            return BillSmoothingInternalErrorTypes.GeneralIneligibility;</span>
        }
    }
&nbsp;
    private hasDuplicateFuels(account: AccountViewModel<span class="fstat-no" title="function not covered" >): boolean {</span>
        const fuelArr = <span class="cstat-no" title="statement not covered" >account.contracts.map((contract<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >contract.fuelType)</span></span>;</span>
<span class="cstat-no" title="statement not covered" >        if (fuelArr.length &gt; 0) {</span>
            const uniqueFuelArr = <span class="cstat-no" title="statement not covered" >_.uniq(fuelArr);</span>
<span class="cstat-no" title="statement not covered" >            return fuelArr.length !== uniqueFuelArr.length;</span>
        } else {
<span class="cstat-no" title="statement not covered" >            return false;</span>
        }
    }
&nbsp;
    private updateAlertForIneligibility(alerts: AlertDisplayModel[], fuel: string, paymentOverdue: number<span class="fstat-no" title="function not covered" >) {</span>
<span class="cstat-no" title="statement not covered" >        alerts.forEach((alert: AlertDisplayModel<span class="fstat-no" title="function not covered" >) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >            if (alert.billSmoothingInternalErrorType === BillSmoothingInternalErrorTypes.BillSmoothingV1) {</span>
<span class="cstat-no" title="statement not covered" >                alert.type = AlertType.inform;</span>
<span class="cstat-no" title="statement not covered" >                alert.heading = 'You are already on Bill Smoothing.';</span>
<span class="cstat-no" title="statement not covered" >                alert.body = 'Your instalment details will be available in here soon. In the meantime &lt;a href="https://www.agl.com.au/residential/contact-us" class="link" target="_blank"&gt;contact us&lt;/a&gt; if you have any questions.';</span>
            } else <span class="cstat-no" title="statement not covered" >if (alert.billSmoothingInternalErrorType === BillSmoothingInternalErrorTypes.Payg) {</span>
<span class="cstat-no" title="statement not covered" >                alert.type = AlertType.inform;</span>
<span class="cstat-no" title="statement not covered" >                alert.body = `If you'd like to switch to Bill Smoothing, get in touch with us &lt;a href="https://www.agl.com.au/residential/contact-us" class="link" target="_blank"&gt;here&lt;/a&gt;.`;</span>
            } else <span class="cstat-no" title="statement not covered" >if (alert.billSmoothingInternalErrorType === BillSmoothingInternalErrorTypes.GeneralIneligibility) {</span>
<span class="cstat-no" title="statement not covered" >                alert.heading = 'This service is not eligible for Bill Smoothing.';</span>
<span class="cstat-no" title="statement not covered" >                alert.body = 'Get in touch with us &lt;a href="https://www.agl.com.au/residential/contact-us" class="link" target="_blank"&gt;here&lt;/a&gt; to find out how you can make the switch to Bill Smoothing.';</span>
            }
        });
    }
&nbsp;
    private updateAlertByBillSmoothingInternalErrorType(billSmoothingInternalErrorType: BillSmoothingInternalErrorTypes, alerts: AlertDisplayModel[], updatingAlert: AlertDisplayModel<span class="fstat-no" title="function not covered" >) {</span>
        const alertToUpdate = <span class="cstat-no" title="statement not covered" >alerts.find((a<span class="fstat-no" title="function not covered" >) =&gt; <span class="cstat-no" title="statement not covered" >a.billSmoothingInternalErrorType === billSmoothingInternalErrorType)</span></span>;</span>
<span class="cstat-no" title="statement not covered" >        if (alertToUpdate) {</span>
<span class="cstat-no" title="statement not covered" >            alertToUpdate.body = updatingAlert.body;</span>
<span class="cstat-no" title="statement not covered" >            alertToUpdate.heading = updatingAlert.heading;</span>
<span class="cstat-no" title="statement not covered" >            alertToUpdate.type = updatingAlert.type;</span>
        }
    }
}
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Apr 19 2018 19:37:05 GMT+1000 (AUS Eastern Standard Time)
</div>
</div>
<script src="../../../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../../../sorter.js"></script>
</body>
</html>
